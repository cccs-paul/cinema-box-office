{{- /*
myRC Helm Chart - Secrets
*/ -}}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "myrc.databaseSecretName" . }}
  namespace: {{ include "myrc.namespace" . }}
  labels:
    {{- include "myrc.labels" . | nindent 4 }}
    app.kubernetes.io/component: database
type: Opaque
data:
  {{- if .Values.postgresql.enabled }}
  db-user: {{ .Values.postgresql.auth.username | b64enc | quote }}
  db-password: {{ .Values.postgresql.auth.password | b64enc | quote }}
  db-name: {{ .Values.postgresql.auth.database | b64enc | quote }}
  {{- else }}
  db-user: {{ .Values.externalDatabase.username | b64enc | quote }}
  db-password: {{ .Values.externalDatabase.password | b64enc | quote }}
  db-name: {{ .Values.externalDatabase.database | b64enc | quote }}
  {{- end }}

{{- if .Values.auth.ldap.enabled }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "myrc.fullname" . }}-ldap-secret
  namespace: {{ include "myrc.namespace" . }}
  labels:
    {{- include "myrc.labels" . | nindent 4 }}
    app.kubernetes.io/component: ldap
type: Opaque
data:
  {{- if .Values.testLdap.enabled }}
  ldap-manager-password: {{ "GoodNewsEveryone" | b64enc | quote }}
  {{- else }}
  ldap-manager-password: {{ .Values.auth.ldap.managerPassword | b64enc | quote }}
  {{- end }}
{{- end }}

{{- if .Values.auth.oauth2.enabled }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "myrc.fullname" . }}-oauth2-secret
  namespace: {{ include "myrc.namespace" . }}
  labels:
    {{- include "myrc.labels" . | nindent 4 }}
    app.kubernetes.io/component: oauth2
type: Opaque
data:
  {{- range $provider, $config := .Values.auth.oauth2.providers }}
  {{ $provider }}-client-id: {{ $config.clientId | b64enc | quote }}
  {{ $provider }}-client-secret: {{ $config.clientSecret | b64enc | quote }}
  {{- end }}
{{- end }}
