<!--
  myRC - RC Configuration Component Template
  Copyright (c) 2026 myRC Team
  Licensed under MIT License
-->
<div class="rc-configuration-page">
  <!-- Header -->
  <div class="page-header">
    <div class="header-left">
      <button class="btn-back" (click)="goBack()">
        <span class="back-icon">‚Üê</span> {{ 'rcConfiguration.backToRcSelection' | translate }}
      </button>
      <h1>‚öôÔ∏è {{ 'rcConfiguration.title' | translate }}</h1>
      <p class="subtitle" *ngIf="rc">{{ rc.name }}</p>
    </div>
  </div>

  <!-- Error Message -->
  <div class="alert alert-error" *ngIf="errorMessage">
    <span>‚ùå</span> {{ errorMessage }}
  </div>

  <!-- Success Message -->
  <div class="alert alert-success" *ngIf="successMessage">
    <span>‚úÖ</span> {{ successMessage }}
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="isLoading">
    <div class="spinner"></div>
    <p>{{ 'common.loading' | translate }}</p>
  </div>

  <!-- Main Content -->
  <div class="content" *ngIf="!isLoading && rc">
    <!-- Configuration Tabs -->
    <div class="config-tabs">
      <button
        class="tab-btn"
        [class.active]="activeTab === 'permissions'"
        (click)="setActiveTab('permissions')">
        <span class="tab-icon">üîê</span>
        <span class="tab-label">{{ 'rcConfiguration.permissionsTab' | translate }}</span>
      </button>
      <button
        class="tab-btn"
        [class.active]="activeTab === 'training'"
        (click)="setActiveTab('training')">
        <span class="tab-icon">üéì</span>
        <span class="tab-label">{{ 'rcConfiguration.trainingTab' | translate }}</span>
      </button>
      <button
        class="tab-btn"
        [class.active]="activeTab === 'travel'"
        (click)="setActiveTab('travel')">
        <span class="tab-icon">‚úàÔ∏è</span>
        <span class="tab-label">{{ 'rcConfiguration.travelTab' | translate }}</span>
      </button>
      <button
        class="tab-btn"
        [class.active]="activeTab === 'audit'"
        (click)="setActiveTab('audit')">
        <span class="tab-icon">üìã</span>
        <span class="tab-label">{{ 'rcConfiguration.auditTab' | translate }}</span>
      </button>
    </div>

    <!-- Permissions Tab Content -->
    <div class="tab-content" *ngIf="activeTab === 'permissions'">
      <app-rc-permissions [embedded]="true"></app-rc-permissions>
    </div>

    <!-- Training Tab Content -->
    <div class="tab-content" *ngIf="activeTab === 'training'">
      <div class="toggle-section">
        <div class="toggle-header">
          <div class="toggle-info">
            <h3>üéì {{ 'rcConfiguration.trainingTitle' | translate }}</h3>
            <p class="toggle-description">{{ 'rcConfiguration.trainingDescription' | translate }}</p>
          </div>
          <div class="toggle-control">
            <label class="toggle-switch" [class.disabled]="!isOwner || togglingTraining || (hasTrainingItems && rc!.trainingEnabled)">
              <input
                type="checkbox"
                [checked]="rc!.trainingEnabled"
                [disabled]="!isOwner || togglingTraining || (hasTrainingItems && rc!.trainingEnabled)"
                (change)="toggleTrainingEnabled()"
              >
              <span class="toggle-slider"></span>
            </label>
            <span class="toggle-status" [class.enabled]="rc!.trainingEnabled" [class.disabled-status]="!rc!.trainingEnabled">
              {{ rc!.trainingEnabled ? ('rcConfiguration.enabled' | translate) : ('rcConfiguration.disabled' | translate) }}
            </span>
          </div>
        </div>
        <div class="toggle-warning" *ngIf="hasTrainingItems && rc!.trainingEnabled">
          <span class="warning-icon">‚ö†Ô∏è</span>
          <span>{{ 'rcConfiguration.cannotDisableTraining' | translate }}</span>
        </div>
        <div class="toggle-warning" *ngIf="!isOwner">
          <span class="warning-icon">‚ö†Ô∏è</span>
          <span>{{ 'rcConfiguration.onlyOwnerCanToggle' | translate }}</span>
        </div>
        <div class="toggle-loading" *ngIf="togglingTraining || checkingTrainingItems">
          <div class="spinner-small"></div>
          <span>{{ 'common.loading' | translate }}</span>
        </div>
      </div>
    </div>

    <!-- Travel Tab Content -->
    <div class="tab-content" *ngIf="activeTab === 'travel'">
      <div class="toggle-section">
        <div class="toggle-header">
          <div class="toggle-info">
            <h3>‚úàÔ∏è {{ 'rcConfiguration.travelTitle' | translate }}</h3>
            <p class="toggle-description">{{ 'rcConfiguration.travelDescription' | translate }}</p>
          </div>
          <div class="toggle-control">
            <label class="toggle-switch" [class.disabled]="!isOwner || togglingTravel || (hasTravelItems && rc!.travelEnabled)">
              <input
                type="checkbox"
                [checked]="rc!.travelEnabled"
                [disabled]="!isOwner || togglingTravel || (hasTravelItems && rc!.travelEnabled)"
                (change)="toggleTravelEnabled()"
              >
              <span class="toggle-slider"></span>
            </label>
            <span class="toggle-status" [class.enabled]="rc!.travelEnabled" [class.disabled-status]="!rc!.travelEnabled">
              {{ rc!.travelEnabled ? ('rcConfiguration.enabled' | translate) : ('rcConfiguration.disabled' | translate) }}
            </span>
          </div>
        </div>
        <div class="toggle-warning" *ngIf="hasTravelItems && rc!.travelEnabled">
          <span class="warning-icon">‚ö†Ô∏è</span>
          <span>{{ 'rcConfiguration.cannotDisableTravel' | translate }}</span>
        </div>
        <div class="toggle-warning" *ngIf="!isOwner">
          <span class="warning-icon">‚ö†Ô∏è</span>
          <span>{{ 'rcConfiguration.onlyOwnerCanToggle' | translate }}</span>
        </div>
        <div class="toggle-loading" *ngIf="togglingTravel || checkingTravelItems">
          <div class="spinner-small"></div>
          <span>{{ 'common.loading' | translate }}</span>
        </div>
      </div>
    </div>

    <!-- Audit Tab Content -->
    <div class="tab-content" *ngIf="activeTab === 'audit'">
      <!-- Not Owner Warning -->
      <div class="audit-not-owner" *ngIf="!isOwner">
        <span class="warning-icon">‚ö†Ô∏è</span>
        <p>{{ 'rcConfiguration.auditNotOwner' | translate }}</p>
      </div>

      <!-- Audit Content (Owner Only) -->
      <div *ngIf="isOwner">
        <!-- Audit Loading -->
        <div class="loading-state" *ngIf="auditLoading">
          <div class="spinner"></div>
          <p>{{ 'common.loading' | translate }}</p>
        </div>

        <!-- Audit Error -->
        <div class="alert alert-error" *ngIf="auditError">
          <span>‚ùå</span> {{ auditError }}
        </div>

        <!-- Audit Empty State -->
        <div class="audit-empty" *ngIf="!auditLoading && !auditError && auditEvents.length === 0">
          <span class="empty-icon">üìã</span>
          <p>{{ 'rcConfiguration.auditEmpty' | translate }}</p>
        </div>

        <!-- Audit Table -->
        <div class="audit-table-container" *ngIf="!auditLoading && !auditError && auditEvents.length > 0">
          <div class="audit-count">
            {{ auditEvents.length }} {{ auditEvents.length === 1 ? 'event' : 'events' }}
          </div>
          <table class="audit-table">
            <thead>
              <tr>
                <th>{{ 'rcConfiguration.auditColumnTimestamp' | translate }}</th>
                <th>{{ 'rcConfiguration.auditColumnUser' | translate }}</th>
                <th>{{ 'rcConfiguration.auditColumnAction' | translate }}</th>
                <th>{{ 'rcConfiguration.auditColumnEntityType' | translate }}</th>
                <th>{{ 'rcConfiguration.auditColumnEntityName' | translate }}</th>
                <th>{{ 'rcConfiguration.auditColumnOutcome' | translate }}</th>
                <th>{{ 'rcConfiguration.auditColumnDetails' | translate }}</th>
              </tr>
            </thead>
            <tbody>
              <ng-container *ngFor="let event of auditEvents">
                <tr [class.expanded]="expandedAuditId === event.id"
                    [class.outcome-success]="event.outcome === 'SUCCESS'"
                    [class.outcome-failure]="event.outcome === 'FAILURE'"
                    [class.outcome-pending]="event.outcome === 'PENDING'">
                  <td class="timestamp-cell">{{ event.createdAt | date:'yyyy-MM-dd HH:mm:ss' }}</td>
                  <td class="user-cell">{{ event.username }}</td>
                  <td class="action-cell">
                    <span class="action-badge">{{ event.action }}</span>
                    <span class="cloned-badge" *ngIf="event.clonedFromAuditId">
                      {{ 'rcConfiguration.auditClonedBadge' | translate }}
                    </span>
                  </td>
                  <td class="entity-type-cell">{{ event.entityType }}</td>
                  <td class="entity-name-cell">{{ event.entityName || '‚Äî' }}</td>
                  <td class="outcome-cell">
                    <span class="outcome-badge" [class]="'outcome-' + event.outcome.toLowerCase()">
                      {{ event.outcome }}
                    </span>
                  </td>
                  <td class="details-cell">
                    <button class="btn-details" (click)="toggleAuditDetails(event.id)">
                      {{ expandedAuditId === event.id
                        ? ('rcConfiguration.auditHideDetails' | translate)
                        : ('rcConfiguration.auditShowDetails' | translate) }}
                    </button>
                  </td>
                </tr>
                <!-- Expanded Details Row -->
                <tr class="details-row" *ngIf="expandedAuditId === event.id">
                  <td colspan="7">
                    <div class="audit-details">
                      <div class="detail-grid">
                        <div class="detail-item" *ngIf="event.httpMethod">
                          <span class="detail-label">{{ 'rcConfiguration.auditColumnMethod' | translate }}:</span>
                          <span class="detail-value method-badge">{{ event.httpMethod }}</span>
                        </div>
                        <div class="detail-item" *ngIf="event.endpoint">
                          <span class="detail-label">{{ 'rcConfiguration.auditColumnEndpoint' | translate }}:</span>
                          <span class="detail-value endpoint-value">{{ event.endpoint }}</span>
                        </div>
                        <div class="detail-item" *ngIf="event.ipAddress">
                          <span class="detail-label">IP:</span>
                          <span class="detail-value">{{ event.ipAddress }}</span>
                        </div>
                        <div class="detail-item" *ngIf="event.userAgent">
                          <span class="detail-label">User Agent:</span>
                          <span class="detail-value user-agent-value">{{ event.userAgent }}</span>
                        </div>
                        <div class="detail-item" *ngIf="event.fiscalYearName">
                          <span class="detail-label">Fiscal Year:</span>
                          <span class="detail-value">{{ event.fiscalYearName }}</span>
                        </div>
                        <div class="detail-item" *ngIf="event.rcName">
                          <span class="detail-label">RC:</span>
                          <span class="detail-value">{{ event.rcName }}</span>
                        </div>
                        <div class="detail-item full-width" *ngIf="event.errorMessage">
                          <span class="detail-label error-label">{{ 'rcConfiguration.auditColumnError' | translate }}:</span>
                          <span class="detail-value error-value">{{ event.errorMessage }}</span>
                        </div>
                        <div class="detail-item full-width" *ngIf="event.parameters">
                          <span class="detail-label">Parameters:</span>
                          <pre class="detail-value parameters-value">{{ event.parameters }}</pre>
                        </div>
                      </div>
                    </div>
                  </td>
                </tr>
              </ng-container>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
