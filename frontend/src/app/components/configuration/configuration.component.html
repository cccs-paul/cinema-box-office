<!--
  myRC - Configuration Component Template
  Copyright (c) 2026 myRC Team
  Licensed under MIT License
-->
<div class="configuration-page">
  <div class="page-header">
    <h1>Configuration</h1>
    <p class="context-info" *ngIf="selectedRC && selectedFY">
      <span class="rc-name">{{ selectedRC.name }}</span>
      <span class="separator">‚Ä∫</span>
      <span class="fy-name">{{ selectedFY.name }}</span>
    </p>
  </div>

  <!-- Success Message -->
  <div class="success-message" *ngIf="successMessage">
    <span class="success-icon">‚úì</span>
    {{ successMessage }}
  </div>

  <!-- Error Message -->
  <div class="error-message" *ngIf="moneyError">
    <span class="error-icon">‚ö†Ô∏è</span>
    {{ moneyError }}
    <button class="dismiss-btn" (click)="clearError()">√ó</button>
  </div>

  <div class="error-message" *ngIf="categoryError">
    <span class="error-icon">‚ö†Ô∏è</span>
    {{ categoryError }}
    <button class="dismiss-btn" (click)="clearCategoryError()">√ó</button>
  </div>

  <!-- Configuration Tabs -->
  <div class="config-tabs">
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'monies'"
      (click)="setActiveTab('monies')">
      <span class="tab-icon">üí∞</span>
      <span class="tab-label">Monies</span>
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'categories'"
      (click)="setActiveTab('categories')">
      <span class="tab-icon">üìÅ</span>
      <span class="tab-label">Spending Categories</span>
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'general'"
      (click)="setActiveTab('general')">
      <span class="tab-icon">‚öôÔ∏è</span>
      <span class="tab-label">General</span>
    </button>
  </div>

  <!-- Monies Tab Content -->
  <div class="tab-content" *ngIf="activeTab === 'monies'">
    <div class="section-header">
      <h2>Money Types</h2>
      <p class="section-description">
        Configure money types for this fiscal year. Each money type has two parts: Capital (CAP) and O&M (OM).
        The default "AB" money type cannot be deleted.
      </p>
    </div>

    <!-- Money List -->
    <div class="money-list" *ngIf="!isLoadingMonies">
      <div 
        class="money-card" 
        *ngFor="let money of monies; trackBy: trackByMoneyId"
        [class.is-default]="money.isDefault"
        [class.is-editing]="editingMoneyId === money.id">
        
        <!-- View Mode -->
        <div class="money-content" *ngIf="editingMoneyId !== money.id">
          <div class="money-header">
            <span class="money-code">{{ money.code }}</span>
            <span class="default-badge" *ngIf="money.isDefault">Default</span>
            <span class="readonly-badge" *ngIf="money.isDefault">Read-only</span>
          </div>
          <div class="money-name">{{ money.name }}</div>
          <div class="money-description" *ngIf="money.description">{{ money.description }}</div>
          <div class="money-parts">
            <span class="part-tag cap">{{ money.capLabel }}</span>
            <span class="part-tag om">{{ money.omLabel }}</span>
          </div>
          <div class="money-info" *ngIf="money.isDefault">
            <span class="info-icon">‚ÑπÔ∏è</span>
            <span class="info-text">The default AB money type is system-managed and cannot be modified or deleted.</span>
          </div>
          <div class="money-actions" *ngIf="!money.isDefault">
            <button 
              class="btn btn-small btn-secondary" 
              (click)="startEditMoney(money)"
              [disabled]="isSaving || isDeleting">
              Edit
            </button>
            <button 
              class="btn btn-small btn-danger" 
              (click)="deleteMoney(money)"
              [disabled]="isSaving || isDeleting"
              title="Delete">
              Delete
            </button>
          </div>
        </div>

        <!-- Edit Mode -->
        <div class="money-edit-form" *ngIf="editingMoneyId === money.id">
          <h4>Edit Money Type</h4>
          <div class="form-row">
            <div class="form-group">
              <label>Code</label>
              <input 
                type="text" 
                [(ngModel)]="editMoney.code"
                maxlength="10"
                [disabled]="money.isDefault || isSaving">
              <span class="form-hint" *ngIf="money.isDefault">Cannot change default code</span>
            </div>
            <div class="form-group">
              <label>Name *</label>
              <input 
                type="text" 
                [(ngModel)]="editMoney.name"
                maxlength="100"
                [disabled]="isSaving">
            </div>
          </div>
          <div class="form-group full-width">
            <label>Description</label>
            <textarea 
              [(ngModel)]="editMoney.description"
              rows="2"
              maxlength="500"
              [disabled]="isSaving"></textarea>
          </div>
          <div class="form-actions">
            <button 
              class="btn btn-secondary" 
              (click)="cancelEditMoney()"
              [disabled]="isSaving">
              Cancel
            </button>
            <button 
              class="btn btn-primary" 
              (click)="updateMoney(money)"
              [disabled]="isSaving || !editMoney.name">
              <span *ngIf="isSaving">Saving...</span>
              <span *ngIf="!isSaving">Update</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="monies.length === 0 && !isAddingMoney">
        <span class="empty-icon">üí∞</span>
        <p>No money types configured yet.</p>
        <button class="btn btn-primary" (click)="startAddMoney()">
          Add Your First Money Type
        </button>
      </div>
    </div>

    <!-- Add Money Button -->
    <div class="action-bar" *ngIf="!isLoadingMonies">
      <button 
        class="btn btn-primary" 
        (click)="startAddMoney()"
        [disabled]="isAddingMoney || isSaving">
        <span class="btn-icon">+</span>
        Add Money Type
      </button>
    </div>

    <!-- Add Money Form -->
    <div class="money-form" *ngIf="isAddingMoney">
      <h3>Add New Money Type</h3>
      <div class="form-row">
        <div class="form-group">
          <label for="new-code">Code *</label>
          <input 
            type="text" 
            id="new-code"
            [(ngModel)]="newMoney.code"
            placeholder="e.g., OA, WCF"
            maxlength="10"
            [disabled]="isSaving">
          <span class="form-hint">Short code (max 10 characters)</span>
        </div>
        <div class="form-group">
          <label for="new-name">Name *</label>
          <input 
            type="text" 
            id="new-name"
            [(ngModel)]="newMoney.name"
            placeholder="e.g., Operating Allotment"
            maxlength="100"
            [disabled]="isSaving">
        </div>
      </div>
      <div class="form-group full-width">
        <label for="new-description">Description</label>
        <textarea 
          id="new-description"
          [(ngModel)]="newMoney.description"
          placeholder="Optional description"
          rows="2"
          maxlength="500"
          [disabled]="isSaving"></textarea>
      </div>
      <div class="form-preview" *ngIf="newMoney.code">
        <span class="preview-label">Preview:</span>
        <span class="preview-tag">{{ newMoney.code | uppercase }} (CAP)</span>
        <span class="preview-tag">{{ newMoney.code | uppercase }} (OM)</span>
      </div>
      <div class="form-actions">
        <button 
          class="btn btn-secondary" 
          (click)="cancelAddMoney()"
          [disabled]="isSaving">
          Cancel
        </button>
        <button 
          class="btn btn-primary" 
          (click)="saveMoney()"
          [disabled]="isSaving || !newMoney.code || !newMoney.name">
          <span *ngIf="isSaving">Saving...</span>
          <span *ngIf="!isSaving">Save Money Type</span>
        </button>
      </div>
    </div>

    <!-- Loading State -->
    <div class="loading-state" *ngIf="isLoadingMonies">
      <span class="loading-spinner"></span>
      <p>Loading money types...</p>
    </div>
  </div>

  <!-- Spending Categories Tab Content -->
  <div class="tab-content" *ngIf="activeTab === 'categories'">
    <div class="section-header">
      <h2>Spending Categories</h2>
      <p class="section-description">
        Configure spending categories for this fiscal year. Categories are used to group and organize spending items.
        Default categories cannot be deleted.
      </p>
    </div>

    <!-- Category List -->
    <div class="category-list" *ngIf="!isLoadingCategories">
      <div 
        class="category-card" 
        *ngFor="let category of categories; trackBy: trackByCategoryId"
        [class.is-default]="category.isDefault"
        [class.is-editing]="editingCategoryId === category.id">
        
        <!-- View Mode -->
        <div class="category-content" *ngIf="editingCategoryId !== category.id">
          <div class="category-header">
            <span class="category-name">{{ category.name }}</span>
            <span class="default-badge" *ngIf="category.isDefault">Default</span>
          </div>
          <div class="category-description" *ngIf="category.description">{{ category.description }}</div>
          <div class="category-actions" *ngIf="!category.isDefault">
            <button 
              class="btn btn-small btn-secondary" 
              (click)="startEditCategory(category)"
              [disabled]="isSaving || isDeleting">
              Edit
            </button>
            <button 
              class="btn btn-small btn-danger" 
              (click)="deleteCategory(category)"
              [disabled]="isSaving || isDeleting"
              title="Delete">
              Delete
            </button>
          </div>
        </div>

        <!-- Edit Mode -->
        <div class="category-edit-form" *ngIf="editingCategoryId === category.id">
          <h4>Edit Spending Category</h4>
          <div class="form-group">
            <label>Name *</label>
            <input 
              type="text" 
              [(ngModel)]="editCategory.name"
              maxlength="100"
              [disabled]="category.isDefault || isSaving">
            <span class="form-hint" *ngIf="category.isDefault">Cannot change default category name</span>
          </div>
          <div class="form-group full-width">
            <label>Description</label>
            <textarea 
              [(ngModel)]="editCategory.description"
              rows="2"
              maxlength="500"
              [disabled]="isSaving"></textarea>
          </div>
          <div class="form-actions">
            <button 
              class="btn btn-secondary" 
              (click)="cancelEditCategory()"
              [disabled]="isSaving">
              Cancel
            </button>
            <button 
              class="btn btn-primary" 
              (click)="updateCategory(category)"
              [disabled]="isSaving || !editCategory.name">
              <span *ngIf="isSaving">Saving...</span>
              <span *ngIf="!isSaving">Update</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="categories.length === 0 && !isAddingCategory">
        <span class="empty-icon">üìÅ</span>
        <p>No spending categories configured yet.</p>
        <button class="btn btn-primary" (click)="startAddCategory()">
          Add Your First Category
        </button>
      </div>
    </div>

    <!-- Add Category Button -->
    <div class="action-bar" *ngIf="!isLoadingCategories">
      <button 
        class="btn btn-primary" 
        (click)="startAddCategory()"
        [disabled]="isAddingCategory || isSaving">
        <span class="btn-icon">+</span>
        Add Category
      </button>
    </div>

    <!-- Add Category Form -->
    <div class="category-form" *ngIf="isAddingCategory">
      <h3>Add New Spending Category</h3>
      <div class="form-group">
        <label for="new-category-name">Name *</label>
        <input 
          type="text" 
          id="new-category-name"
          [(ngModel)]="newCategory.name"
          placeholder="e.g., Cloud Services, Maintenance"
          maxlength="100"
          [disabled]="isSaving">
      </div>
      <div class="form-group full-width">
        <label for="new-category-description">Description</label>
        <textarea 
          id="new-category-description"
          [(ngModel)]="newCategory.description"
          placeholder="Optional description"
          rows="2"
          maxlength="500"
          [disabled]="isSaving"></textarea>
      </div>
      <div class="form-actions">
        <button 
          class="btn btn-secondary" 
          (click)="cancelAddCategory()"
          [disabled]="isSaving">
          Cancel
        </button>
        <button 
          class="btn btn-primary" 
          (click)="saveCategory()"
          [disabled]="isSaving || !newCategory.name">
          <span *ngIf="isSaving">Saving...</span>
          <span *ngIf="!isSaving">Save Category</span>
        </button>
      </div>
    </div>

    <!-- Loading State -->
    <div class="loading-state" *ngIf="isLoadingCategories">
      <span class="loading-spinner"></span>
      <p>Loading spending categories...</p>
    </div>
  </div>

  <!-- General Tab Content -->
  <div class="tab-content" *ngIf="activeTab === 'general'">
    <div class="section-header">
      <h2>General Settings</h2>
      <p class="section-description">
        Additional configuration options will be available here in future releases.
      </p>
    </div>
    <div class="coming-soon">
      <span class="coming-soon-icon">üöß</span>
      <p>More configuration options coming soon!</p>
    </div>
  </div>
</div>
