<!--
  myRC - Configuration Component Template
  Copyright (c) 2026 myRC Team
  Licensed under MIT License
-->
<div class="configuration-page">
  <!-- Success Message -->
  <div class="success-message" *ngIf="successMessage">
    <span class="success-icon">‚úì</span>
    {{ successMessage }}
  </div>

  <!-- Error Message -->
  <div class="error-message" *ngIf="moneyError">
    <span class="error-icon">‚ö†Ô∏è</span>
    {{ moneyError }}
    <button class="dismiss-btn" (click)="clearError()">√ó</button>
  </div>

  <div class="error-message" *ngIf="categoryError">
    <span class="error-icon">‚ö†Ô∏è</span>
    {{ categoryError }}
    <button class="dismiss-btn" (click)="clearCategoryError()">√ó</button>
  </div>

  <!-- Read-Only Notice -->
  <div class="info-message" *ngIf="isReadOnly">
    <span class="info-icon">üîí</span>
    {{ 'configuration.readOnlyNotice' | translate }}
  </div>

  <!-- Configuration Tabs -->
  <div class="config-tabs">
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'general'"
      (click)="setActiveTab('general')">
      <span class="tab-icon">‚öôÔ∏è</span>
      <span class="tab-label">{{ 'configuration.general' | translate }}</span>
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'monies'"
      (click)="setActiveTab('monies')">
      <span class="tab-icon">üí∞</span>
      <span class="tab-label">{{ 'configuration.monies' | translate }}</span>
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'categories'"
      (click)="setActiveTab('categories')">
      <span class="tab-icon">üìÅ</span>
      <span class="tab-label">{{ 'configuration.categories' | translate }}</span>
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'summary'"
      (click)="setActiveTab('summary')">
      <span class="tab-icon">üìä</span>
      <span class="tab-label">{{ 'summary.title' | translate }}</span>
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'import-export'"
      (click)="setActiveTab('import-export')">
      <span class="tab-icon">üì•</span>
      <span class="tab-label">{{ 'configuration.importExport' | translate }}</span>
    </button>
  </div>

  <!-- Monies Tab Content -->
  <div class="tab-content" *ngIf="activeTab === 'monies'">
    <div class="section-header">
      <h2>{{ 'configuration.moneyTypesTitle' | translate }}</h2>
      <p class="section-description">
        {{ 'configuration.moneyTypesDesc' | translate }}
      </p>
    </div>

    <!-- Money List -->
    <div class="money-list" *ngIf="!isLoadingMonies">
      <div 
        class="money-card" 
        *ngFor="let money of monies; trackBy: trackByMoneyId"
        [class.is-default]="money.isDefault"
        [class.is-editing]="editingMoneyId === money.id">
        
        <!-- View Mode -->
        <div class="money-content" *ngIf="editingMoneyId !== money.id">
          <div class="money-header">
            <span class="money-code">{{ money.code }}</span>
            <span class="default-badge" *ngIf="money.isDefault">{{ 'configuration.default' | translate }}</span>
            <span class="readonly-badge" *ngIf="money.isDefault">{{ 'configuration.readOnly' | translate }}</span>
          </div>
          <div class="money-name">{{ money.name }}</div>
          <div class="money-description" *ngIf="money.description">{{ money.description }}</div>
          <div class="money-parts">
            <span class="part-tag cap">{{ money.capLabel }}</span>
            <span class="part-tag om">{{ money.omLabel }}</span>
          </div>
          <div class="money-actions" *ngIf="!money.isDefault && !isReadOnly">
            <button 
              class="btn btn-secondary" 
              (click)="startEditMoney(money)"
              [disabled]="isSaving || isDeleting">
              {{ 'common.edit' | translate }}
            </button>
            <button 
              class="btn btn-danger" 
              (click)="deleteMoney(money)"
              [disabled]="isSaving || isDeleting || money.canDelete === false"
              [title]="money.canDelete === false ? ('configuration.cannotDeleteMoneyInUse' | translate) : ('common.delete' | translate)">
              {{ 'common.delete' | translate }}
            </button>
          </div>
        </div>

        <!-- Edit Mode -->
        <div class="money-edit-form" *ngIf="editingMoneyId === money.id && !isReadOnly">
          <h4>{{ 'configuration.editMoneyType' | translate }}</h4>
          <div class="form-row">
            <div class="form-group">
              <label>{{ 'configuration.code' | translate }}</label>
              <input 
                type="text" 
                [(ngModel)]="editMoney.code"
                maxlength="10"
                [disabled]="money.isDefault || isSaving">
              <span class="form-hint" *ngIf="money.isDefault">{{ 'configuration.cannotChangeDefaultCode' | translate }}</span>
            </div>
            <div class="form-group">
              <label>{{ 'common.name' | translate }} *</label>
              <input 
                type="text" 
                [(ngModel)]="editMoney.name"
                maxlength="100"
                [disabled]="isSaving">
            </div>
          </div>
          <div class="form-group full-width">
            <label>{{ 'common.description' | translate }}</label>
            <textarea 
              [(ngModel)]="editMoney.description"
              rows="2"
              maxlength="500"
              [disabled]="isSaving"></textarea>
          </div>
          <div class="form-actions">
            <button 
              class="btn btn-secondary" 
              (click)="cancelEditMoney()"
              [disabled]="isSaving">
              {{ 'common.cancel' | translate }}
            </button>
            <button 
              class="btn btn-primary" 
              (click)="updateMoney(money)"
              [disabled]="isSaving || !editMoney.name">
              <span *ngIf="isSaving">{{ 'common.save' | translate }}...</span>
              <span *ngIf="!isSaving">{{ 'configuration.update' | translate }}</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="monies.length === 0 && !isAddingMoney">
        <span class="empty-icon">üí∞</span>
        <p>{{ 'configuration.noMoneyTypes' | translate }}</p>
        <button class="btn btn-primary" (click)="startAddMoney()" [disabled]="isReadOnly">
          {{ 'configuration.addFirstMoneyType' | translate }}
        </button>
      </div>
    </div>

    <!-- Add Money Button -->
    <div class="action-bar" *ngIf="!isLoadingMonies">
      <button 
        class="btn btn-primary" 
        (click)="startAddMoney()"
        [disabled]="isAddingMoney || isSaving || isReadOnly">
        <span class="btn-icon">+</span>
        {{ 'configuration.addMoney' | translate }}
      </button>
    </div>

    <!-- Add Money Form -->
    <div class="money-form" *ngIf="isAddingMoney && !isReadOnly">
      <h3>{{ 'configuration.addNewMoneyType' | translate }}</h3>
      <div class="form-row">
        <div class="form-group">
          <label for="new-code">{{ 'configuration.code' | translate }} *</label>
          <input 
            type="text" 
            id="new-code"
            [(ngModel)]="newMoney.code"
            [placeholder]="'configuration.codePlaceholder' | translate"
            maxlength="10"
            [disabled]="isSaving">
          <span class="form-hint">{{ 'configuration.codeHint' | translate }}</span>
        </div>
        <div class="form-group">
          <label for="new-name">{{ 'common.name' | translate }} *</label>
          <input 
            type="text" 
            id="new-name"
            [(ngModel)]="newMoney.name"
            [placeholder]="'configuration.namePlaceholder' | translate"
            maxlength="100"
            [disabled]="isSaving">
        </div>
      </div>
      <div class="form-group full-width">
        <label for="new-description">{{ 'common.description' | translate }}</label>
        <textarea 
          id="new-description"
          [(ngModel)]="newMoney.description"
          [placeholder]="'configuration.descriptionPlaceholder' | translate"
          rows="2"
          maxlength="500"
          [disabled]="isSaving"></textarea>
      </div>
      <div class="form-preview" *ngIf="newMoney.code">
        <span class="preview-label">{{ 'configuration.preview' | translate }}</span>
        <span class="preview-tag">{{ newMoney.code | uppercase }} (CAP)</span>
        <span class="preview-tag">{{ newMoney.code | uppercase }} (O&M)</span>
      </div>
      <div class="form-actions">
        <button 
          class="btn btn-secondary" 
          (click)="cancelAddMoney()"
          [disabled]="isSaving">
          {{ 'common.cancel' | translate }}
        </button>
        <button 
          class="btn btn-primary" 
          (click)="saveMoney()"
          [disabled]="isSaving || !newMoney.code || !newMoney.name">
          <span *ngIf="isSaving">{{ 'common.save' | translate }}...</span>
          <span *ngIf="!isSaving">{{ 'configuration.saveMoneyType' | translate }}</span>
        </button>
      </div>
    </div>

    <!-- Loading State -->
    <div class="loading-state" *ngIf="isLoadingMonies">
      <span class="loading-spinner"></span>
      <p>{{ 'configuration.loadingMoneyTypes' | translate }}</p>
    </div>
  </div>

  <!-- Categories Tab Content -->
  <div class="tab-content" *ngIf="activeTab === 'categories'">
    <div class="section-header">
      <h2>{{ 'configuration.categories' | translate }}</h2>
      <p class="section-description">
        {{ 'configuration.categoriesDesc' | translate }}
      </p>
    </div>

    <!-- Category List -->
    <div class="category-list" *ngIf="!isLoadingCategories">
      <div 
        class="category-card" 
        *ngFor="let category of categories; trackBy: trackByCategoryId"
        [class.is-default]="category.isDefault"
        [class.is-editing]="editingCategoryId === category.id">
        
        <!-- View Mode -->
        <div class="category-content" *ngIf="editingCategoryId !== category.id">
          <div class="category-header">
            <span class="category-code">{{ getCategoryDisplayName(category) }}</span>
            <span class="default-badge" *ngIf="category.isDefault">{{ 'configuration.default' | translate }}</span>
            <span class="readonly-badge" *ngIf="category.isDefault">{{ 'configuration.readOnly' | translate }}</span>
          </div>
          <div class="category-description" *ngIf="category.description">{{ getCategoryDescriptionDisplay(category) }}</div>
          <div class="category-tags">
            <span class="category-tag" [class.default-category]="category.isDefault" [class.custom-category]="!category.isDefault">
              {{ category.isDefault ? ('configuration.system' | translate) : ('configuration.custom' | translate) }}
            </span>
            <span class="funding-type-tag" 
                  [class.cap-only]="category.fundingType === 'CAP_ONLY'"
                  [class.om-only]="category.fundingType === 'OM_ONLY'"
                  [class.both]="category.fundingType === 'BOTH' || !category.fundingType">
              {{ getFundingTypeLabel(category.fundingType) }}
            </span>
          </div>
          <div class="category-actions" *ngIf="!category.isDefault && !isReadOnly">
            <button 
              class="btn btn-secondary" 
              (click)="startEditCategory(category)"
              [disabled]="isSaving || isDeleting">
              {{ 'common.edit' | translate }}
            </button>
            <button 
              class="btn btn-danger" 
              (click)="deleteCategory(category)"
              [disabled]="isSaving || isDeleting || category.canDelete === false"
              [title]="category.canDelete === false ? ('configuration.cannotDeleteCategoryInUse' | translate) : ('common.delete' | translate)">
              {{ 'common.delete' | translate }}
            </button>
          </div>
        </div>

        <!-- Edit Mode (only for custom categories) -->
        <div class="category-edit-form" *ngIf="editingCategoryId === category.id && !category.isDefault && !isReadOnly">
          <h4>{{ 'configuration.editCategory' | translate }}</h4>
          <div class="form-group">
            <label>{{ 'common.name' | translate }} *</label>
            <input 
              type="text" 
              [(ngModel)]="editCategory.name"
              maxlength="100"
              [disabled]="isSaving">
          </div>
          <div class="form-group full-width">
            <label>{{ 'common.description' | translate }}</label>
            <textarea 
              [(ngModel)]="editCategory.description"
              rows="2"
              maxlength="500"
              [disabled]="isSaving"></textarea>
          </div>
          <div class="form-group">
            <label>{{ 'configuration.fundingType' | translate }}</label>
            <select [(ngModel)]="editCategory.fundingType" [disabled]="isSaving">
              <option *ngFor="let ft of fundingTypeOptions" [value]="ft">
                {{ getFundingTypeLabel(ft) }}
              </option>
            </select>
            <span class="form-hint">{{ 'configuration.fundingTypeHint' | translate }}</span>
          </div>
          <div class="form-actions">
            <button 
              class="btn btn-secondary" 
              (click)="cancelEditCategory()"
              [disabled]="isSaving">
              {{ 'common.cancel' | translate }}
            </button>
            <button 
              class="btn btn-primary" 
              (click)="updateCategory(category)"
              [disabled]="isSaving || !editCategory.name">
              <span *ngIf="isSaving">{{ 'common.save' | translate }}...</span>
              <span *ngIf="!isSaving">{{ 'configuration.update' | translate }}</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="categories.length === 0 && !isAddingCategory">
        <span class="empty-icon">üìÅ</span>
        <p>{{ 'configuration.noCategories' | translate }}</p>
        <button class="btn btn-primary" (click)="startAddCategory()" [disabled]="isReadOnly">
          {{ 'configuration.addFirstCategory' | translate }}
        </button>
      </div>
    </div>

    <!-- Add Category Button -->
    <div class="action-bar" *ngIf="!isLoadingCategories">
      <button 
        class="btn btn-primary" 
        (click)="startAddCategory()"
        [disabled]="isAddingCategory || isSaving || isReadOnly">
        <span class="btn-icon">+</span>
        {{ 'configuration.addCategory' | translate }}
      </button>
    </div>

    <!-- Add Category Form -->
    <div class="category-form" *ngIf="isAddingCategory && !isReadOnly">
      <h3>{{ 'configuration.addNewCategory' | translate }}</h3>
      <div class="form-group">
        <label for="new-category-name">{{ 'common.name' | translate }} *</label>
        <input 
          type="text" 
          id="new-category-name"
          [(ngModel)]="newCategory.name"
          [placeholder]="'configuration.categoryNamePlaceholder' | translate"
          maxlength="100"
          [disabled]="isSaving">
      </div>
      <div class="form-group full-width">
        <label for="new-category-description">{{ 'common.description' | translate }}</label>
        <textarea 
          id="new-category-description"
          [(ngModel)]="newCategory.description"
          [placeholder]="'configuration.descriptionPlaceholder' | translate"
          rows="2"
          maxlength="500"
          [disabled]="isSaving"></textarea>
      </div>
      <div class="form-group">
        <label for="new-category-funding-type">{{ 'configuration.fundingType' | translate }}</label>
        <select 
          id="new-category-funding-type"
          [(ngModel)]="newCategory.fundingType" 
          [disabled]="isSaving">
          <option *ngFor="let ft of fundingTypeOptions" [value]="ft">
            {{ getFundingTypeLabel(ft) }}
          </option>
        </select>
        <span class="form-hint">
          {{ 'configuration.fundingTypeCapOnlyDesc' | translate }}<br>
          {{ 'configuration.fundingTypeOmOnlyDesc' | translate }}<br>
          {{ 'configuration.fundingTypeBothDesc' | translate }}
        </span>
      </div>
      <div class="form-actions">
        <button 
          class="btn btn-secondary" 
          (click)="cancelAddCategory()"
          [disabled]="isSaving">
          {{ 'common.cancel' | translate }}
        </button>
        <button 
          class="btn btn-primary" 
          (click)="saveCategory()"
          [disabled]="isSaving || !newCategory.name">
          <span *ngIf="isSaving">{{ 'common.save' | translate }}...</span>
          <span *ngIf="!isSaving">{{ 'configuration.saveCategory' | translate }}</span>
        </button>
      </div>
    </div>

    <!-- Loading State -->
    <div class="loading-state" *ngIf="isLoadingCategories">
      <span class="loading-spinner"></span>
      <p>{{ 'configuration.loadingCategories' | translate }}</p>
    </div>
  </div>

  <!-- General Tab Content -->
  <div class="tab-content" *ngIf="activeTab === 'general'">
    <div class="section-header">
      <h2>{{ 'configuration.generalSettings' | translate }}</h2>
      <p class="section-description">
        {{ 'configuration.generalSettingsDesc' | translate }}
      </p>
    </div>

    <!-- Display Settings -->
    <div class="settings-section">
      <h3>{{ 'configuration.displaySettings' | translate }}</h3>
      
      <div class="setting-card">
        <div class="setting-info">
          <span class="setting-label">{{ 'configuration.showSearchBox' | translate }}</span>
          <span class="setting-description">{{ 'configuration.showSearchBoxDesc' | translate }}</span>
        </div>
        <div class="setting-control">
          <label class="toggle-switch">
            <input 
              type="checkbox" 
              [checked]="selectedFY?.showSearchBox !== false"
              (change)="updateDisplaySettings('showSearchBox', $any($event.target).checked)"
              [disabled]="isReadOnly">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>

      <div class="setting-card">
        <div class="setting-info">
          <span class="setting-label">{{ 'configuration.showCategoryFilter' | translate }}</span>
          <span class="setting-description">{{ 'configuration.showCategoryFilterDesc' | translate }}</span>
        </div>
        <div class="setting-control">
          <label class="toggle-switch">
            <input 
              type="checkbox" 
              [checked]="selectedFY?.showCategoryFilter !== false"
              (change)="updateDisplaySettings('showCategoryFilter', $any($event.target).checked)"
              [disabled]="isReadOnly">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>

      <div class="setting-card">
        <div class="setting-info">
          <span class="setting-label">{{ 'configuration.groupByCategory' | translate }}</span>
          <span class="setting-description">{{ 'configuration.groupByCategoryDesc' | translate }}</span>
        </div>
        <div class="setting-control">
          <label class="toggle-switch">
            <input 
              type="checkbox" 
              [checked]="selectedFY?.groupByCategory === true"
              (change)="updateDisplaySettings('groupByCategory', $any($event.target).checked)"
              [disabled]="isReadOnly">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
    </div>
  </div>

  <!-- Summary Tab Content -->
  <div class="tab-content" *ngIf="activeTab === 'summary'">
    <div class="section-header">
      <h2>{{ 'configuration.summarySettings' | translate }}</h2>
      <p class="section-description">
        {{ 'configuration.summarySettingsDesc' | translate }}
      </p>
    </div>

    <!-- On Target Settings -->
    <div class="settings-section">
      <h3>{{ 'configuration.onTargetSettings' | translate }}</h3>
      <p class="section-description">
        {{ 'configuration.onTargetSettingsDesc' | translate }}
      </p>
      
      <div class="setting-card range-setting">
        <div class="setting-info">
          <span class="setting-label">{{ 'configuration.minimumThreshold' | translate }}</span>
          <span class="setting-description">
            {{ 'configuration.minimumThresholdDesc' | translate }}
          </span>
        </div>
        <div class="setting-control range-control">
          <input 
            type="range" 
            class="range-slider"
            min="-100" 
            max="100" 
            step="1"
            [value]="selectedFY?.onTargetMin ?? -10"
            (input)="onTargetMinValue = $any($event.target).value"
            (change)="updateOnTargetSetting('onTargetMin', $any($event.target).value)"
            [disabled]="isReadOnly">
          <span class="range-value">{{ onTargetMinValue ?? selectedFY?.onTargetMin ?? -10 }}%</span>
        </div>
      </div>

      <div class="setting-card range-setting">
        <div class="setting-info">
          <span class="setting-label">{{ 'configuration.maximumThreshold' | translate }}</span>
          <span class="setting-description">
            {{ 'configuration.maximumThresholdDesc' | translate }}
          </span>
        </div>
        <div class="setting-control range-control">
          <input 
            type="range" 
            class="range-slider"
            min="-100" 
            max="100" 
            step="1"
            [value]="selectedFY?.onTargetMax ?? 10"
            (input)="onTargetMaxValue = $any($event.target).value"
            (change)="updateOnTargetSetting('onTargetMax', $any($event.target).value)"
            [disabled]="isReadOnly">
          <span class="range-value">{{ onTargetMaxValue ?? selectedFY?.onTargetMax ?? 10 }}%</span>
        </div>
      </div>

      <div class="on-target-preview">
        <span class="preview-label">{{ 'configuration.preview' | translate }}</span>
        <div class="preview-range">
          <span class="preview-under">{{ 'configuration.underBudget' | translate }}</span>
          <span class="preview-target">
            {{ 'configuration.onTarget' | translate }} ({{ selectedFY?.onTargetMin ?? -2 }}% to {{ selectedFY?.onTargetMax ?? 2 }}%)
          </span>
          <span class="preview-over">{{ 'configuration.overBudget' | translate }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Import/Export Tab Content -->
  <div class="tab-content" *ngIf="activeTab === 'import-export'">
    <div class="section-header">
      <h2>{{ 'configuration.exportDataTitle' | translate }}</h2>
    </div>

    <!-- Export Section -->
    <div class="import-export-section">
      <h3>{{ 'configuration.exportTitle' | translate }}</h3>
      <p class="section-description">
        {{ 'configuration.exportLineItemsDesc' | translate }}
      </p>
      
      <div class="export-options">
        <div class="form-group">
          <label for="exportPath">{{ 'configuration.exportDestination' | translate }}</label>
          <div class="file-input-group">
            <input 
              type="text" 
              id="exportPath" 
              [(ngModel)]="exportPath"
              [placeholder]="'configuration.selectDestination' | translate"
              readonly
              class="file-path-input"
            />
            <button 
              type="button" 
              class="btn btn-secondary"
              (click)="selectExportDestination()">
              {{ 'configuration.browse' | translate }}
            </button>
          </div>
        </div>
        
        <div class="export-actions">
          <button 
            type="button" 
            class="btn btn-primary"
            (click)="exportToCSV()"
            [disabled]="isExporting || !isExportValid()">
            <span *ngIf="!isExporting">üì§ {{ 'configuration.exportToCsv' | translate }}</span>
            <span *ngIf="isExporting">{{ 'configuration.exporting' | translate }}</span>
          </button>
        </div>
      </div>
      
      <div class="alert alert-success" *ngIf="exportSuccessMessage">
        {{ exportSuccessMessage }}
      </div>
      <div class="alert alert-error" *ngIf="exportErrorMessage">
        {{ exportErrorMessage }}
      </div>
    </div>

    <!-- Import Section -->
    <div class="import-export-section">
      <h3>{{ 'configuration.importTitle' | translate }}</h3>
      <p class="section-description">
        {{ 'configuration.importLineItemsDesc' | translate }}
      </p>
      
      <div class="import-options">
        <div class="form-group">
          <label for="importPath">{{ 'configuration.importFile' | translate }}</label>
          <div class="file-input-group">
            <input 
              type="text" 
              id="importPath" 
              [placeholder]="'configuration.selectFile' | translate"
              readonly
              disabled
              class="file-path-input"
            />
            <button 
              type="button" 
              class="btn btn-secondary"
              disabled>
              {{ 'configuration.browse' | translate }}
            </button>
          </div>
        </div>
        
        <div class="import-actions">
          <button 
            type="button" 
            class="btn btn-primary"
            disabled
            [title]="'configuration.importNotice' | translate">
            üì• {{ 'configuration.importFromCsv' | translate }}
          </button>
        </div>
      </div>
      
      <div class="import-notice">
        <span class="notice-icon">‚ÑπÔ∏è</span>
        <span class="notice-text">{{ 'configuration.importNotice' | translate }}</span>
      </div>
    </div>
  </div>
</div>
