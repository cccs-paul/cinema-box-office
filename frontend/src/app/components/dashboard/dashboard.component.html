<!--
  Cinema Box Office - Dashboard Component Template
  Copyright (c) 2026 Box Office Team
  Licensed under MIT License
-->
<div class="dashboard-container" [class.logging-out]="isLoggingOut">
  <!-- Header Navigation -->
  <header class="dashboard-header">
    <div class="header-content">
      <div class="header-title">
        <h1>{{ title }}</h1>
      </div>
      <nav class="header-nav">
        <div class="user-menu-container">
          <button (click)="toggleUserMenu()" class="btn-user-menu" title="User menu">
            <span class="user-avatar">üë§</span>
            <span class="user-name">{{ currentUser?.fullName || currentUser?.username }}</span>
            <span class="menu-arrow" [class.open]="isUserMenuOpen">‚ñº</span>
          </button>
          <div *ngIf="isUserMenuOpen" class="user-menu-dropdown" (click)="$event.stopPropagation()">
            <div class="menu-header">
              <div class="menu-user-info">
                <span class="menu-username">{{ currentUser?.username }}</span>
                <span class="menu-email">{{ currentUser?.email }}</span>
              </div>
            </div>
            <div class="menu-divider"></div>
            <div class="menu-items">
              <button (click)="toggleProfileCard()" class="menu-item">
                <span class="menu-icon">üë§</span>
                <span>View Profile</span>
              </button>
              <button (click)="toggleTheme()" class="menu-item">
                <span class="menu-icon">{{ getThemeIcon() }}</span>
                <span>{{ currentTheme === 'light' ? 'Dark' : 'Light' }} Theme</span>
              </button>
              <button (click)="goToDeveloperTools()" class="menu-item">
                <span class="menu-icon">üõ†Ô∏è</span>
                <span>Developer Tools</span>
              </button>
              <div class="menu-divider"></div>
              <button (click)="logout()" class="menu-item logout-item" [disabled]="isLoggingOut">
                <span class="menu-icon">üö™</span>
                <span *ngIf="!isLoggingOut">Sign Out</span>
                <span *ngIf="isLoggingOut">Signing Out...</span>
              </button>
            </div>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <!-- Main Content -->
  <main class="dashboard-main">
    <!-- User Profile Card - Toggleable -->
    <div *ngIf="isProfileCardVisible" class="profile-card-container">
      <section class="card user-profile-card">
        <div class="card-header">
          <div class="profile-card-header-content">
            <h2>üë§ User Profile</h2>
            <button (click)="toggleProfileCard()" class="btn-close-profile" title="Close profile">‚úï</button>
          </div>
        </div>
        <div class="card-body" *ngIf="currentUser">
          <div class="profile-section">
            <div class="profile-field">
              <label>Username</label>
              <span class="profile-value">{{ currentUser.username }}</span>
            </div>
            <div class="profile-field">
              <label>Full Name</label>
              <span class="profile-value">{{ currentUser.fullName || 'N/A' }}</span>
            </div>
            <div class="profile-field">
              <label>Email</label>
              <span class="profile-value">{{ currentUser.email }}</span>
            </div>
          </div>

          <div class="profile-section">
            <div class="profile-field">
              <label>Auth Provider</label>
              <span class="profile-value">
                <span class="badge" [class]="'badge-' + currentUser.authProvider.toLowerCase()">
                  {{ currentUser.authProvider }}
                </span>
              </span>
            </div>
            <div class="profile-field">
              <label>Roles</label>
              <span class="profile-value">
                <span *ngFor="let role of currentUser.roles; let last = last" class="badge badge-role">
                  {{ role }}<span *ngIf="!last">, </span>
                </span>
              </span>
            </div>
            <div class="profile-field">
              <label>Account Status</label>
              <span class="profile-value">
                <span *ngIf="currentUser.enabled" class="status-badge status-active">‚úì Active</span>
                <span *ngIf="!currentUser.enabled" class="status-badge status-inactive">‚úó Inactive</span>
              </span>
            </div>
          </div>

          <div class="profile-section">
            <div class="profile-field">
              <label>Email Verified</label>
              <span class="profile-value">
                <span *ngIf="currentUser.emailVerified" class="status-badge status-verified">‚úì Yes</span>
                <span *ngIf="!currentUser.emailVerified" class="status-badge status-unverified">‚úó No</span>
              </span>
            </div>
            <div class="profile-field">
              <label>Account Locked</label>
              <span class="profile-value">
                <span *ngIf="currentUser.accountLocked" class="status-badge status-locked">üîí Locked</span>
                <span *ngIf="!currentUser.accountLocked" class="status-badge status-unlocked">üîì Unlocked</span>
              </span>
            </div>
          </div>

          <div class="profile-section timestamps">
            <div class="profile-field">
              <label>Last Login</label>
              <span class="profile-value small">{{ formatDate(currentUser.lastLoginAt) }}</span>
            </div>
            <div class="profile-field">
              <label>Account Created</label>
              <span class="profile-value small">{{ formatDate(currentUser.createdAt) }}</span>
            </div>
            <div class="profile-field">
              <label>Last Updated</label>
              <span class="profile-value small">{{ formatDate(currentUser.updatedAt) }}</span>
            </div>
          </div>

          <div *ngIf="currentUser.profileDescription" class="profile-section">
            <div class="profile-field">
              <label>Description</label>
              <p class="profile-description">{{ currentUser.profileDescription }}</p>
            </div>
          </div>
        </div>
      </section>
    </div>

    <div class="dashboard-grid">
      <section class="card status-card">
        <div class="card-header">
          <h2>üîß System Status</h2>
        </div>
        <div class="card-body">
          <div class="status-section">
            <div class="status-item">
              <label>REST API</label>
              <div [class.healthy]="isApiHealthy" [class.unhealthy]="!isApiHealthy" class="status-indicator">
                <span class="status-dot"></span>
                <span class="status-text">{{ apiStatus }}</span>
              </div>
            </div>
            <div class="status-item">
              <label>Database</label>
              <div [class.healthy]="isDatabaseHealthy" [class.unhealthy]="!isDatabaseHealthy" class="status-indicator">
                <span class="status-dot"></span>
                <span class="status-text">{{ databaseStatus }}</span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Developer Tools Card -->
      <section class="card tools-card">
        <div class="card-header">
          <h2>üõ†Ô∏è Developer Tools</h2>
        </div>
        <div class="card-body">
          <div class="tools-grid">
            <a href="http://localhost:8080/api/swagger-ui.html" target="_blank" class="tool-link">
              <span class="tool-icon">üìö</span>
              <span class="tool-name">API Swagger</span>
              <span class="tool-desc">Interactive API documentation</span>
            </a>
            <a href="http://localhost:5050" target="_blank" class="tool-link">
              <span class="tool-icon">üóÑÔ∏è</span>
              <span class="tool-name">Database Console</span>
              <span class="tool-desc">PostgreSQL management</span>
            </a>
            <a href="http://localhost:8080/api/health" target="_blank" class="tool-link">
              <span class="tool-icon">‚ù§Ô∏è</span>
              <span class="tool-name">API Health</span>
              <span class="tool-desc">API health check endpoint</span>
            </a>
            <a href="http://localhost:8080/api/health/db" target="_blank" class="tool-link">
              <span class="tool-icon">üìä</span>
              <span class="tool-name">DB Health</span>
              <span class="tool-desc">Database health check endpoint</span>
            </a>
          </div>
        </div>
      </section>

      <!-- Quick Info Card -->
      <section class="card info-card">
        <div class="card-header">
          <h2>‚ÑπÔ∏è Quick Info</h2>
        </div>
        <div class="card-body">
          <div class="info-item">
            <p>
              <strong>Application:</strong> Cinema Box Office Management System
            </p>
          </div>
          <div class="info-item">
            <p>
              <strong>Version:</strong> 1.0.0
            </p>
          </div>
          <div class="info-item">
            <p>
              <strong>Authentication:</strong> LOCAL (App-managed), LDAP, OAuth2
            </p>
          </div>
          <div class="info-item">
            <p>
              <strong>Frontend:</strong> Angular 17
            </p>
          </div>
          <div class="info-item">
            <p>
              <strong>Backend:</strong> Spring Boot 3.2.0 (Java 21)
            </p>
          </div>
          <div class="info-item">
            <p>
              <strong>Database:</strong> PostgreSQL 16
            </p>
          </div>
          <div class="info-item">
            <p>
              <strong>License:</strong> MIT
            </p>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- Footer -->
  <footer class="dashboard-footer">
    <p>&copy; 2026 Cinema Box Office. All rights reserved.</p>
  </footer>
</div>
